<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corre√ß√£o de Cache do Navegador - Medicare</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }
        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .btn-warning {
            background: linear-gradient(45deg, #ff9800, #f57c00);
        }
        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }
        .result {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196F3; }
        .step {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 3px solid #2196F3;
        }
        .keyboard-shortcut {
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Corre√ß√£o de Cache do Navegador</h1>
        
        <div class="section">
            <h2>üö® Problema Identificado</h2>
            <p>O erro <code>net::ERR_ABORTED</code> que voc√™ est√° vendo √© causado por problemas de cache do navegador, n√£o por conectividade com o Supabase.</p>
            <p><strong>‚úÖ Conectividade Supabase: OK (100% dos testes passaram)</strong></p>
        </div>

        <div class="section">
            <h2>üõ†Ô∏è Solu√ß√µes Autom√°ticas</h2>
            
            <div class="step">
                <h3>1. Limpar Cache Completo</h3>
                <button class="btn" onclick="clearAllCache()">üßπ Limpar Tudo</button>
                <div id="clear-result" class="result"></div>
            </div>

            <div class="step">
                <h3>2. Recarregar Sem Cache</h3>
                <button class="btn btn-warning" onclick="hardReload()">üîÑ Reload For√ßado</button>
                <div id="reload-result" class="result"></div>
            </div>

            <div class="step">
                <h3>3. Testar Conectividade</h3>
                <button class="btn" onclick="testSupabaseConnection()">üåê Testar Supabase</button>
                <div id="connection-result" class="result"></div>
            </div>
        </div>

        <div class="section">
            <h2>‚å®Ô∏è Solu√ß√µes Manuais</h2>
            
            <div class="step">
                <h3>Chrome/Edge:</h3>
                <p>1. Pressione <span class="keyboard-shortcut">Ctrl+Shift+R</span> (Windows) ou <span class="keyboard-shortcut">Cmd+Shift+R</span> (Mac)</p>
                <p>2. Ou pressione <span class="keyboard-shortcut">F12</span> ‚Üí aba Network ‚Üí marque "Disable cache"</p>
                <p>3. Ou v√° em Configura√ß√µes ‚Üí Privacidade ‚Üí Limpar dados de navega√ß√£o</p>
            </div>

            <div class="step">
                <h3>Firefox:</h3>
                <p>1. Pressione <span class="keyboard-shortcut">Ctrl+Shift+R</span> (Windows) ou <span class="keyboard-shortcut">Cmd+Shift+R</span> (Mac)</p>
                <p>2. Ou pressione <span class="keyboard-shortcut">F12</span> ‚Üí √≠cone de engrenagem ‚Üí marque "Disable HTTP Cache"</p>
            </div>

            <div class="step">
                <h3>Safari:</h3>
                <p>1. Pressione <span class="keyboard-shortcut">Cmd+Option+R</span></p>
                <p>2. Ou v√° em Develop ‚Üí Empty Caches</p>
            </div>
        </div>

        <div class="section">
            <h2>üîç Modo Inc√≥gnito/Privado</h2>
            <p>Teste a aplica√ß√£o em modo inc√≥gnito para verificar se o problema persiste:</p>
            <button class="btn btn-warning" onclick="openIncognito()">üïµÔ∏è Abrir em Modo Inc√≥gnito</button>
            <div id="incognito-result" class="result"></div>
        </div>

        <div class="section">
            <h2>üéØ Links Diretos para Teste</h2>
            <button class="btn" onclick="testDemoPages()">üß™ Testar P√°ginas Demo</button>
            <div id="demo-test-result" class="result"></div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'info',
                success: 'success',
                error: 'error',
                warning: 'warning'
            };
            return `<span class="${colors[type]}">[${timestamp}] ${message}</span>\n`;
        }

        function clearAllCache() {
            const resultDiv = document.getElementById('clear-result');
            resultDiv.innerHTML = log('üßπ Iniciando limpeza completa do cache...', 'info');
            
            try {
                // Limpar localStorage
                const localStorageKeys = Object.keys(localStorage);
                localStorage.clear();
                resultDiv.innerHTML += log(`‚úÖ localStorage limpo (${localStorageKeys.length} itens removidos)`, 'success');
                
                // Limpar sessionStorage
                const sessionStorageKeys = Object.keys(sessionStorage);
                sessionStorage.clear();
                resultDiv.innerHTML += log(`‚úÖ sessionStorage limpo (${sessionStorageKeys.length} itens removidos)`, 'success');
                
                // Tentar limpar cache do service worker
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.getRegistrations().then(registrations => {
                        registrations.forEach(registration => {
                            registration.unregister();
                        });
                        resultDiv.innerHTML += log('‚úÖ Service Workers removidos', 'success');
                    });
                }
                
                // Limpar cache de aplica√ß√£o
                if ('caches' in window) {
                    caches.keys().then(cacheNames => {
                        cacheNames.forEach(cacheName => {
                            caches.delete(cacheName);
                        });
                        resultDiv.innerHTML += log(`‚úÖ Cache de aplica√ß√£o limpo (${cacheNames.length} caches)`, 'success');
                    });
                }
                
                resultDiv.innerHTML += log('üéâ Limpeza completa finalizada!', 'success');
                resultDiv.innerHTML += log('üí° Recarregue a p√°gina para aplicar as mudan√ßas', 'warning');
                
            } catch (error) {
                resultDiv.innerHTML += log(`‚ùå Erro durante limpeza: ${error.message}`, 'error');
            }
        }

        function hardReload() {
            const resultDiv = document.getElementById('reload-result');
            resultDiv.innerHTML = log('üîÑ Executando reload for√ßado...', 'info');
            
            setTimeout(() => {
                // Tentar diferentes m√©todos de reload for√ßado
                if (window.location.reload) {
                    window.location.reload(true); // For√ßa reload sem cache
                } else {
                    window.location.href = window.location.href + '?cache_bust=' + Date.now();
                }
            }, 1000);
        }

        async function testSupabaseConnection() {
            const resultDiv = document.getElementById('connection-result');
            resultDiv.innerHTML = log('üåê Testando conectividade com Supabase...', 'info');
            
            const supabaseUrl = 'https://envqimsupjgovuofbghj.supabase.co';
            const apiKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVudnFpbXN1cGpnb3Z1b2ZiZ2hqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4MTEyMzQsImV4cCI6MjA3MzM4NzIzNH0.5OJAgPbqiTEomwuMzOfisow2G1m2wVxZ3nGIkekTNjU';
            
            try {
                // Teste 1: Ping b√°sico
                resultDiv.innerHTML += log('üì° Teste 1: Ping b√°sico...', 'info');
                const pingResponse = await fetch(supabaseUrl, { 
                    method: 'HEAD',
                    cache: 'no-cache'
                });
                resultDiv.innerHTML += log(`‚úÖ Ping: ${pingResponse.status}`, 'success');
                
                // Teste 2: API REST
                resultDiv.innerHTML += log('üîå Teste 2: API REST...', 'info');
                const apiResponse = await fetch(`${supabaseUrl}/rest/v1/`, {
                    headers: {
                        'apikey': apiKey,
                        'Authorization': `Bearer ${apiKey}`
                    },
                    cache: 'no-cache'
                });
                resultDiv.innerHTML += log(`‚úÖ API REST: ${apiResponse.status}`, 'success');
                
                // Teste 3: Query de eventos
                resultDiv.innerHTML += log('üìä Teste 3: Query de eventos...', 'info');
                const eventsResponse = await fetch(`${supabaseUrl}/rest/v1/events?select=*&limit=1`, {
                    headers: {
                        'apikey': apiKey,
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    cache: 'no-cache'
                });
                
                if (eventsResponse.ok) {
                    const events = await eventsResponse.json();
                    resultDiv.innerHTML += log(`‚úÖ Eventos: ${events.length} registros encontrados`, 'success');
                } else {
                    resultDiv.innerHTML += log(`‚ö†Ô∏è Eventos: ${eventsResponse.status} - ${eventsResponse.statusText}`, 'warning');
                }
                
                resultDiv.innerHTML += log('üéâ Todos os testes de conectividade passaram!', 'success');
                resultDiv.innerHTML += log('üí° O problema √© definitivamente cache do navegador', 'warning');
                
            } catch (error) {
                resultDiv.innerHTML += log(`‚ùå Erro de conectividade: ${error.message}`, 'error');
                resultDiv.innerHTML += log('üîç Verifique sua conex√£o com a internet', 'warning');
            }
        }

        function openIncognito() {
            const resultDiv = document.getElementById('incognito-result');
            resultDiv.innerHTML = log('üïµÔ∏è Abrindo em modo inc√≥gnito...', 'info');
            
            const urls = [
                'http://localhost:8081/demo/signup',
                'http://localhost:8081/demo/login',
                'http://localhost:8081/demo/dashboard'
            ];
            
            urls.forEach((url, index) => {
                setTimeout(() => {
                    window.open(url, '_blank');
                    resultDiv.innerHTML += log(`üîó Aberto: ${url}`, 'info');
                }, index * 500);
            });
            
            resultDiv.innerHTML += log('üí° Teste as p√°ginas nas novas abas inc√≥gnitas', 'warning');
        }

        function testDemoPages() {
            const resultDiv = document.getElementById('demo-test-result');
            resultDiv.innerHTML = log('üß™ Testando p√°ginas demo...', 'info');
            
            const pages = [
                { name: 'Cadastro Demo', url: 'http://localhost:8081/demo/signup' },
                { name: 'Login Demo', url: 'http://localhost:8081/demo/login' },
                { name: 'Dashboard Demo', url: 'http://localhost:8081/demo/dashboard' },
                { name: 'Landing Demo', url: 'http://localhost:8081/demo' }
            ];
            
            pages.forEach((page, index) => {
                setTimeout(async () => {
                    try {
                        const response = await fetch(page.url, { 
                            method: 'HEAD',
                            cache: 'no-cache'
                        });
                        
                        if (response.ok) {
                            resultDiv.innerHTML += log(`‚úÖ ${page.name}: Acess√≠vel`, 'success');
                            resultDiv.innerHTML += log(`   üîó <a href="${page.url}" target="_blank" style="color: #4CAF50;">${page.url}</a>`, 'info');
                        } else {
                            resultDiv.innerHTML += log(`‚ö†Ô∏è ${page.name}: ${response.status}`, 'warning');
                        }
                    } catch (error) {
                        resultDiv.innerHTML += log(`‚ùå ${page.name}: ${error.message}`, 'error');
                    }
                }, index * 300);
            });
            
            setTimeout(() => {
                resultDiv.innerHTML += log('', 'info');
                resultDiv.innerHTML += log('üéØ Clique nos links acima para testar cada p√°gina', 'warning');
                resultDiv.innerHTML += log('üí° Se ainda houver erros, use Ctrl+Shift+R para reload for√ßado', 'info');
            }, pages.length * 300 + 500);
        }

        // Auto-executar teste de conectividade ao carregar
        window.addEventListener('load', () => {
            setTimeout(testSupabaseConnection, 1000);
        });
    </script>
</body>
</html>